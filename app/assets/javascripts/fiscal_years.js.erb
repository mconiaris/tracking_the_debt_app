// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
// # You can use CoffeeScript in this file: http://coffeescript.org/

<% environment.context_class.instance_eval { include FiscalYearsHelper } %>

// TODO: Find a cleaner way to bring the variables into the Dygraph

// Load default graph
// containing div
// CSV or path to a CSV file. Loaded through  fiscal years helper


gdp_dollars = [
  [1940,6.7,9.6],
  [1941,7.5,11.7],
  [1942,9.9,23.8],
  [1943,13.0,42.6],
  [1944,20.5,42.7],
  [1945,19.9,41.0],
  [1946,17.2,24.2],
  [1947,16.1,14.4],
  [1948,15.8,11.3],
  [1949,14.2,14.0],
  [1950,14.1,15.3],
  [1951,15.8,13.9],
  [1952,18.5,18.9],
  [1953,18.2,19.9],
  [1954,18.0,18.3],
  [1955,16.1,16.8],
  [1956,17.0,16.1],
  [1957,17.2,16.5],
  [1958,16.8,17.4],
  [1959,15.7,18.2],
  [1960,17.3,17.2],
  [1961,17.2,17.8],
  [1962,17.0,18.2],
  [1963,17.2,18.0],
  [1964,17.0,17.9],
  [1965,16.4,16.6],
  [1966,16.7,17.2],
  [1967,17.8,18.8],
  [1968,17.0,19.8],
  [1969,19.0,18.7],
  [1970,18.4,18.6],
  [1971,16.7,18.8],
  [1972,17.0,18.9],
  [1973,17.0,18.1],
  [1974,17.7,18.1],
  [1975,17.3,20.6],
  [1976,16.6,20.8],
  [1977,17.5,20.2],
  [1978,17.5,20.1],
  [1979,18.0,19.6],
  [1980,18.5,21.1],
  [1981,19.1,21.6],
  [1982,18.6,22.5],
  [1983,17.0,22.8],
  [1984,16.9,21.5],
  [1985,17.2,22.2],
  [1986,17.0,21.8],
  [1987,17.9,21.0],
  [1988,17.6,20.6],
  [1989,17.8,20.5],
  [1990,17.4,21.2],
  [1991,17.3,21.7],
  [1992,17.0,21.5],
  [1993,17.0,20.7],
  [1994,17.5,20.3],
  [1995,17.8,20.0],
  [1996,18.2,19.6],
  [1997,18.6,18.9],
  [1998,19.2,18.5],
  [1999,19.2,17.9],
  [2000,19.9,17.6],
  [2001,18.8,17.6],
  [2002,17.0,18.5],
  [2003,15.7,19.1],
  [2004,15.6,19.0],
  [2005,16.7,19.2],
  [2006,17.6,19.4],
  [2007,17.9,19.0],
  [2008,17.1,20.2],
  [2009,14.6,24.4],
  [2010,14.6,23.4],
  [2011,15.0,23.4],
  [2012,15.2,22.0],
  [2013,16.7,20.8],
  [2014,17.3,21.1],
  [2015,18.3,21.4],
  [2016,18.6,21.4],
  [2017,18.9,21.1],
  [2018,19.0,20.9],
  [2019,19.0,21.3]
]

surplus_deficit_current_dollars = [
  [1940,-2.9],
  [1941,-4.9],
  [1942,-20.5],
  [1943,-54.6],
  [1944,-47.6],
  [1945,-47.6],
  [1946,-15.9],
  [1947,4.0],
  [1948,11.8],
  [1949,0.6],
  [1950,-3.1],
  [1951,6.1],
  [1952,-1.5],
  [1953,-6.5],
  [1954,-1.2],
  [1955,-3.0],
  [1956,3.9],
  [1957,3.4],
  [1958,-2.8],
  [1959,-12.8],
  [1960,0.3],
  [1961,-3.3],
  [1962,-7.1],
  [1963,-4.8],
  [1964,-5.9],
  [1965,-1.4],
  [1966,-3.7],
  [1967,-8.6],
  [1968,-25.2],
  [1969,3.2],
  [1970,-2.8],
  [1971,-23.0],
  [1972,-23.4],
  [1973,-14.9],
  [1974,-6.1],
  [1975,-53.2],
  [1976,-73.7],
  [1977,-53.7],
  [1978,-59.2],
  [1979,-40.7],
  [1980,-73.8],
  [1981,-79.0],
  [1982,-128.0],
  [1983,-207.8],
  [1984,-185.4],
  [1985,-212.3],
  [1986,-221.2],
  [1987,-149.7],
  [1988,-155.2],
  [1989,-152.6],
  [1990,-221.0],
  [1991,-269.2],
  [1992,-290.3],
  [1993,-255.1],
  [1994,-203.2],
  [1995,-164.0],
  [1996,-107.4],
  [1997,-21.9],
  [1998,69.3],
  [1999,125.6],
  [2000,236.2],
  [2001,128.2],
  [2002,-157.8],
  [2003,-377.6],
  [2004,-412.7],
  [2005,-318.3],
  [2006,-248.2],
  [2007,-160.7],
  [2008,-458.6],
  [2009,-1412.7],
  [2010,-1294.4],
  [2011,-1299.6],
  [2012,-1087.0],
  [2013,-679.5],
  [2014,-648.8],
  [2015,-563.6],
  [2016,-531.1],
  [2017,-457.8],
  [2018,-413.3],
  [2019,-502.7]
]

surplus_deficit_constant_dollars = [
  [1940,-42.9],
  [1941,-66.6],
  [1942,-238.4],
  [1943,-570.1],
  [1944,-538.6],
  [1945,-570.9],
  [1946,-189.7],
  [1947,42.8],
  [1948,118.6],
  [1949,6.0],
  [1950,-31.0],
  [1951,60.7],
  [1952,-15.1],
  [1953,-60.2],
  [1954,-10.4],
  [1955,-26.0],
  [1956,32.8],
  [1957,27.1],
  [1958,-20.7],
  [1959,-92.5],
  [1960,2.1],
  [1961,-23.1],
  [1962,-49.6],
  [1963,-31.7],
  [1964,-38.7],
  [1965,-9.1],
  [1966,-23.2],
  [1967,-53.1],
  [1968,-149.0],
  [1969,18.1],
  [1970,-15.0],
  [1971,-113.5],
  [1972,-108.0],
  [1973,-65.8],
  [1974,-25.0],
  [1975,-197.6],
  [1976,-255.5],
  [1977,-173.3],
  [1978,-179.8],
  [1979,-114.0],
  [1980,-187.0],
  [1981,-180.0],
  [1982,-271.3],
  [1983,-419.9],
  [1984,-358.9],
  [1985,-398.0],
  [1986,-403.9],
  [1987,-265.9],
  [1988,-266.6],
  [1989,-252.6],
  [1990,-355.0],
  [1991,-413.3],
  [1992,-429.6],
  [1993,-366.6],
  [1994,-286.7],
  [1995,-224.8],
  [1996,-144.2],
  [1997,-28.8],
  [1998,90.3],
  [1999,161.7],
  [2000,296.7],
  [2001,156.9],
  [2002,-189.8],
  [2003,-441.9],
  [2004,-470.4],
  [2005,-350.6],
  [2006,-264.2],
  [2007,-166.7],
  [2008,-459.5],
  [2009,-1412.7],
  [2010,-1279.3],
  [2011,-1259.7],
  [2012,-1034.1],
  [2013,-636.1],
  [2014,-598.5],
  [2015,-510.3],
  [2016,-471.0],
  [2017,-397.4],
  [2018,-350.9],
  [2019,-417.4]
]

surplus_deficit_gdp_dollars = [
  [1940,-3.0],
  [1941,-4.3],
  [1942,-13.9],
  [1943,-29.6],
  [1944,-22.2],
  [1945,-21.0],
  [1946,-7.0],
  [1947,1.7],
  [1948,4.5],
  [1949,0.2],
  [1950,-1.1],
  [1951,1.9],
  [1952,-0.4],
  [1953,-1.7],
  [1954,-0.3],
  [1955,-0.7],
  [1956,0.9],
  [1957,0.7],
  [1958,-0.6],
  [1959,-2.5],
  [1960,0.1],
  [1961,-0.6],
  [1962,-1.2],
  [1963,-0.8],
  [1964,-0.9],
  [1965,-0.2],
  [1966,-0.5],
  [1967,-1.0],
  [1968,-2.8],
  [1969,0.3],
  [1970,-0.3],
  [1971,-2.1],
  [1972,-1.9],
  [1973,-1.1],
  [1974,-0.4],
  [1975,-3.3],
  [1976,-4.1],
  [1977,-2.6],
  [1978,-2.6],
  [1979,-1.6],
  [1980,-2.6],
  [1981,-2.5],
  [1982,-3.9],
  [1983,-5.9],
  [1984,-4.7],
  [1985,-5.0],
  [1986,-4.9],
  [1987,-3.1],
  [1988,-3.0],
  [1989,-2.7],
  [1990,-3.7],
  [1991,-4.4],
  [1992,-4.5],
  [1993,-3.8],
  [1994,-2.8],
  [1995,-2.2],
  [1996,-1.3],
  [1997,-0.3],
  [1998,0.8],
  [1999,1.3],
  [2000,2.3],
  [2001,1.2],
  [2002,-1.5],
  [2003,-3.3],
  [2004,-3.4],
  [2005,-2.5],
  [2006,-1.8],
  [2007,-1.1],
  [2008,-3.1],
  [2009,-9.8],
  [2010,-8.8],
  [2011,-8.4],
  [2012,-6.8],
  [2013,-4.1],
  [2014,-3.7],
  [2015,-3.1],
  [2016,-2.8],
  [2017,-2.3],
  [2018,-1.9],
  [2019,-2.3]
]

$(document).ready(function() {
  console.log( "fiscal_years.js ready" );

  g = new Dygraph(

    document.getElementById("graphdiv"),

    <%= current_dollars %>,
    {
      labels: [ "Fiscal Year", "Receipts", "Outlays" ],
      drawPoints: true,
      xlabel:"Fiscal Year",
      ylabel:"In Billions of Dollars",
      title: "Receipts & Outlays in Current Dollars: 1940-2019",
      titleHeight: 25,
      pointSize: 2,
      // TODO: If statement that turns surplus green
      colors: ["green", "red"],
      axisLabelFontSize: 12
    }
  );

  // retrieve the jQuery wrapped dom object identified by the selector '#choices'
  var sel = $('#choices');
  // assign a change listener to it
  sel.change(function(){ //inside the listener
    // retrieve the value of the object firing the event (referenced by this)
    var value = $(this).val();
    // print it in the logs
    console.log(value + " selected."); // crashes in IE, if console not open
    // make the text of all label elements be the value
    $('label').text(value);
  }); // close the change listener


  // Responds to user's choice of desired graph.
  $('#choices').change(function() {

    // Receipts & Outlays (Current Dollars)
    if($('#choices option:selected').val() == "current-receipts") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Receipts & Outlays Current Dollars: 1940-2019";
      g.user_attrs_.ylabel = "In Billions of Dollars";
      g.user_attrs_.labels = [ "Fiscal Year", "Receipts", "Outlays" ];
      g.updateOptions({file: <%= current_dollars %>})
      g.drawGraph_();
  //     // Receipts & Outlays (2009 Dollars)
    } else if ($('#choices option:selected').val() == "constant-receipts") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Receipts & Outlays in Constant (2009) Dollars: 1940-2019";
      g.user_attrs_.labels = [ "Fiscal Year", "Receipts", "Outlays" ];
      g.updateOptions({file: <%= constant_dollars %> })
      g.drawGraph_();
      // Receipts & Outlays as Percentage of GDP
    } else if ($('#choices option:selected').val() == "gdp-receipts") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Receipts & Outlays as a Percentage of GDP: 1940-2019";
      g.user_attrs_.labels = [ "Fiscal Year", "Receipts", "Outlays" ];
      g.updateOptions({file: gdp_dollars })
      g.drawGraph_();
  //     // Surpluses or Deficits (Current Dollars)
    } else if ($('#choices option:selected').val() == "current-surpluses") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Surpluses or Deficits in Current Dollars: 1940-2019";
      g.user_attrs_.ylabel = "Percentage Surplus or Deficit";
      g.user_attrs_.labels = [ "Fiscal Year", "Surplus/Deficit" ];
      g.updateOptions({file: surplus_deficit_current_dollars });

      g.drawGraph_();
      // Surpluses or Deficits (2009 Dollars)
    } else if ($('#choices option:selected').val() == "constant-surpluses") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Surpluses or Deficits in Constant (2009) Dollars: 1940-2019";
      g.updateOptions({file: surplus_deficit_constant_dollars });
      g.user_attrs_.labels = [ "Fiscal Year", "Surplus/Deficit" ];
      g.drawGraph_();
      // Surpluses or Deficits as Percentage of GDP
    } else if ($('#choices option:selected').val() == "gdp-surpluses") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Surpluses or Deficits as a Percentage of GDP: 1940-2019";
      g.user_attrs_.labels = [ "Fiscal Year", "Surplus/Deficit" ];
      g.updateOptions({file: surplus_deficit_gdp_dollars });
      g.drawGraph_();
    } else {
      console.log("Option selected not configured. Keeping existing graph.");
    }
  });

});

