// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
// # You can use CoffeeScript in this file: http://coffeescript.org/

<% environment.context_class.instance_eval { include FiscalYearsHelper } %>

// TODO: Find a cleaner way to bring the variables into the Dygraph

// Load default graph
// containing div
// CSV or path to a CSV file. Loaded through  fiscal years helper
$(document).ready(function() {
  console.log( "fiscal_years.js ready" );


  g = new Dygraph(

    document.getElementById("graphdiv"),

    <%= current_dollars %>,
    {
      labels: [ "Fiscal Year", "Receipts", "Outlays" ],
      drawPoints: true,
      xlabel:"Fiscal Year",
      ylabel:"In Billions of Dollars",
      title: "Receipts & Outlays in Current Dollars: 1940-2019",
      titleHeight: 25,
      pointSize: 2,
      // TODO: If statement that turns surplus green
      colors: ["green", "red"],
      axisLabelFontSize: 12
    }
  );

  $(".dropdown-menu li a").click(function(){

    console.log(".dropdown-menu li a equals '" + this.text + "'");
    console.log(".dropdown-menu li a equals '" + this.id + "'");

    if(this.id == "current-receipts") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Receipts & Outlays Current Dollars: 1940-2019";
      g.user_attrs_.ylabel = "In Billions of Dollars";
      g.user_attrs_.labels = [ "Fiscal Year", "Receipts", "Outlays" ];
      g.updateOptions({file: <%= current_dollars %>})
      g.drawGraph_();
  //     // Receipts & Outlays (2009 Dollars)
    } else if (this.id == "constant-receipts") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Receipts & Outlays in Constant (2009) Dollars: 1940-2019";
      g.user_attrs_.labels = [ "Fiscal Year", "Receipts", "Outlays" ];
      g.updateOptions({file: <%= constant_dollars %> })
      g.drawGraph_();
      // Receipts & Outlays as Percentage of GDP
    } else if (this.id == "gdp-receipts") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Receipts & Outlays as a Percentage of GDP: 1940-2019";
      g.user_attrs_.labels = [ "Fiscal Year", "Receipts", "Outlays" ];
      g.updateOptions({file: <%= gdp_dollars %> })
      g.drawGraph_();
  //     // Surpluses or Deficits (Current Dollars)
    } else if (this.id == "current-surpluses") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Surpluses or Deficits in Current Dollars: 1940-2019";
      g.user_attrs_.ylabel = "Percentage Surplus or Deficit";
      g.user_attrs_.labels = [ "Fiscal Year", "Surplus/Deficit" ];
      g.updateOptions({file: <%= surplus_deficit_current_dollars %> });

      g.drawGraph_();
      // Surpluses or Deficits (2009 Dollars)
    } else if (this.id == "constant-surpluses") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Surpluses or Deficits in Constant (2009) Dollars: 1940-2019";
      g.updateOptions({file: <%= surplus_deficit_constant_dollars %> });
      g.user_attrs_.labels = [ "Fiscal Year", "Surplus/Deficit" ];
      g.drawGraph_();
      // Surpluses or Deficits as Percentage of GDP
    } else if (this.id == "gdp-surpluses") {
      console.log("#choices option:selected equals " + $('#choices option:selected').val());
      g.user_attrs_.title = "Surpluses or Deficits as a Percentage of GDP: 1940-2019";
      g.user_attrs_.labels = [ "Fiscal Year", "Surplus/Deficit" ];
      g.updateOptions({file: <%= surplus_deficit_gdp_dollars %> });
      g.drawGraph_();
    } else {
      console.log("Option selected not configured. Keeping existing graph.");
    }
   });
});

